################################ GENERAL #####################################

# BINDING: Set to 0.0.0.0 to allow access from outside the Docker container.
bind 0.0.0.0

# PORT: Set to 6383 to match your original AIL configuration.
port 6383

# TIMEOUT: Close the connection after a client is idle for N seconds (0 to disable)
timeout 0

# WORKERS: The number of worker threads.
workers 8

# DAEMONIZE: Always 'no' for Docker.
daemonize no

# SOCKET: Support for passing file descriptors (Standard in newer versions)
socket-fd -1

################################ AUTHENTICATION ##############################

# PASSWORD: Set to 'ail' to match your original configuration.
requirepass ail

# MASTERAUTH: If you use replication, set this to the master's password.
# masterauth ail

################################ CLUSTER #####################################

cluster-enabled no
persist-cluster-nodes-enabled yes

################################ REPLICATION #################################

# Namespace replication settings
repl-namespace-enabled no

# Standard limits
maxclients 10000
db-name change.me.db

# DIRECTORY: Standard path for Docker persistence. 
# Ensure your docker-compose maps a volume to this path.
dir /var/lib/kvrocks

# LOGGING: Standard Docker logging (stdout)
log-dir stdout
log-level info
log-retention-days -1

# SLAVE SETTINGS
slave-read-only yes
slave-priority 100
slave-serve-stale-data yes
slave-empty-db-before-fullsync no
purge-backup-on-fullsync no

# REPLICATION TIMEOUTS (Newer defaults)
replication-connect-timeout-ms 3100
replication-recv-timeout-ms 3200
replication-group-sync no
replication-no-slowdown yes

################################ LIMITS & PROTOCOLS ##########################

# Max replication speed (0 = unlimited)
max-replication-mb 0
max-io-mb 0
max-db-size 0

# Backup retention
max-backup-to-keep 1
max-backup-keep-hours 24

# Compatibility settings
redis-cursor-compatible yes
resp3-enabled yes
json-max-nesting-depth 1024
json-storage-format json

# Experimental Transactional Context (Default: no)
txn-context-enabled no
lua-strict-key-accessing no

################################ SECURITY (TLS) ##############################

# TLS is disabled by default (port 0)
tls-port 0
tls-auth-clients no
tls-prefer-server-ciphers yes
tls-session-caching no
tls-replication no

################################ LOGGING & MONITORING ########################

# SLOW LOG
slowlog-log-slower-than 100000
slowlog-max-len 128
slowlog-dump-logfile-level off

# PERF LOG
profiling-sample-ratio 0
profiling-sample-record-max-len 256
profiling-sample-record-threshold-ms 100

################################ CRON (MAINTENANCE) ##########################

# Compaction Checker (Newer Syntax)
# Checks for compaction needs between 0:00 and 7:00 AM daily
compaction-checker-cron * 0-7 * * *

# Auto-resize estimated keyspace
# dbsize-scan-cron 0 * * * *

################################ MIGRATION ###################################

migrate-type raw-key-value
migrate-speed 4096
migrate-pipeline-size 16
migrate-sequence-gap 10000
migrate-batch-size-kb 16
migrate-batch-rate-limit-mb 16

################################ ROCKSDB TUNING ##############################
# Modern defaults for performance

rocksdb.block_cache_size 4096
rocksdb.block_cache_type lru
rocksdb.max_open_files 8096
rocksdb.write_buffer_size 64
rocksdb.target_file_size_base 128
rocksdb.max_write_buffer_number 4
rocksdb.min_write_buffer_number_to_merge 1
rocksdb.max_background_jobs 4
rocksdb.max_subcompactions 2
rocksdb.wal_compression no
rocksdb.max_total_wal_size 512
rocksdb.dump_malloc_stats yes
rocksdb.wal_ttl_seconds 10800
rocksdb.wal_size_limit_mb 16384
rocksdb.block_size 16384
rocksdb.cache_index_and_filter_blocks yes
rocksdb.compression snappy
rocksdb.compression_level 32767
rocksdb.compaction_readahead_size 2097152
rocksdb.compression_start_level 2

# ASYNC IO: Enabled for performance (Requires modern Kernel/Docker)
rocksdb.read_options.async_io yes

rocksdb.write_options.sync no
rocksdb.write_options.disable_wal no
rocksdb.write_options.no_slowdown no
rocksdb.rate_limiter_auto_tuned yes
rocksdb.partition_filters yes

# BLOB DB (Large value optimization)
rocksdb.enable_blob_files no
rocksdb.min_blob_size 4096
rocksdb.blob_file_size 268435456
rocksdb.enable_blob_garbage_collection yes
rocksdb.blob_garbage_collection_age_cutoff 25
enable-blob-cache no

# LEVEL COMPACTION
rocksdb.level_compaction_dynamic_level_bytes yes
rocksdb.max_bytes_for_level_base 268435456
rocksdb.max_bytes_for_level_multiplier 10

################################ NAMESPACES ##################################
# Imported from your AIL configuration

namespace.cor ail_correls
namespace.crawl ail_crawlers
namespace.db ail_datas
namespace.dup ail_dups
namespace.lg ail_langs
namespace.obj ail_objs
namespace.rel ail_rels
namespace.se ail_searchs
namespace.stat ail_stats
namespace.tag ail_tags
namespace.tl ail_tls
namespace.track ail_trackers